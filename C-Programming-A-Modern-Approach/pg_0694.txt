mbrlen

mbrtowc

wcerilomb

 

29.5  The <wchar.h> Header (C99) 669

= morlen, mbrtowc, and wcrtomb have an additional parameter named ps.
When one of these functions is called. the corresponding argument should
point to a variable of type mbstate_t;the function will store the state of the
conversion in this variable. If the argument corresponding to ps is a null
pointer, the function will use an internal variable to store the conversion state.
(Atthe beginning of program execution, this variable is set to the initial con-
version state.)

u When the s parameter is a null pointer, the older mblen. mbtowc, and
wctomb functions return a nonzero value if multibyte character encodings
have state-dependent encodines (and zero otherwise). The newer functions
don t have this behavior.

# mbrlen, mbrtowc, and wcrtomb return a value of type size_t instead of
int, the return type of the older functions.

À call ofmbrlen 1s equivalent to the call
mbrtowc (NULL, s, n, ps)

except that if ps is a null pointer, then the address of an internal variable is used
instead.
If s is a null pointer, à call of mbrtowc is equivalent to the call

mbrtowc (NULL, "", 1, ps)

Otherwise, a call of mbrtowc examines up to n bytes pointed to by s to see if they
complete a valid multibyte character. (Note that a multibyte character may already
be in progress prior to the call, as tracked by the mbstate_t variable to which
ps points.) IF so, these bytes are converted into a wide character. The wide charac-
ter is stored in the location pointed to by pwc as long as pwc isn’t null. If this char-
acter is the null wide character, the mbstate t variable used during the call is
left in the initial conversion state.

mbrtowc has a variety of possible return values. It returns O if the conversion
produces a null wide character. It returns a number betwcen | and n if the conver-
sion produces a wide character other than null, where the value returned is the
number of bytes used to complete the multibyte character. It returns —2 if the n
bytes pointed to by s aren’t enough to complete a multibyte character (although
the bytes themselves were valid). Finally, it returns —1 if an encoding error occurs
(the function encounters bytes that don'1 form à valid multibyte character). In the
last case, mbrtowc also stores EILSEQ in errno.

If s is a null pointer, a call of wortomb is equivalent to

wertomb (bu£f, L'\0', ps)

where bu£ is an internal buffer. Otherwise, wertomb converts wc from a wide
character into à multibyte character, which it stores in the array pointed to by s.
If wc is a null wide character, wertomb stores a null byte. preceded by a shift
sequence if one is necessary to restore the initial shift state. In this case, the
