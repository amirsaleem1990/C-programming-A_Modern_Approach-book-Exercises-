670

Chapter 25

mbsriowces
wesrtombs

International Features

mbstate_t variable used during the call is left in the initial conversion state.
wertomb returns the number of bytes that it stores, including shift sequences. If
wc isn’t a valid wide character, the function returns —! and stores EILSEO in
errno.

Restartable Multibyte/Wide-String Conversion Functions

size t mbsrtowcs (wchar t * restrict dst,
const char ** restrict src,
size t len,
mbstate t * restrict ps);
size t wcsrtombs (char * restrict dst,
const wchar t ** restrict src,
size t len,
mbstate t * restrict ps);

The mbsrtowcs and wcsrtombs functions are restartable versions of
mbstowcs and wostombs, which belong to <stdlib.h> and are discussed in
Section 25.2. mbsrtowcs and wosrtombs are the same as their <stdlib.h>
counterparts, excepl for the following differences:

u mbosrtowcs and wesrtombs have an additional parameter named ps.
When one of these functions is called. the corresponding argument should
point to a variable oftype mbstate t;the function will store the state of the
conversion in this variable. If the argument corresponding to ps is a null
pointer, the function will use an internal variable to store the conversion state.
(At the beginning of program execution, this variable is set to the initial con-
version state.) Both functions update the state as the conversion proceeds. !f
the conversion stops because a null character is reached, the mbstate t
vartable will be left in the initial conversion state.

m The src parameter, which represents the array containing characters to be
converted (the source array), is a pointer to a pointer for mbsrtowcs and
wesrtombs. (In the older mbstowcs and woestombs functions, the corre-
sponding parameter was simply a pointer.) This change allows mbsrtowcs
and wesrtombs to keep track of where the conversion stopped. The pointer
to which src points is set to null if the conversion stopped because a null
character was reached. Otherwise, this pointer is set Lo point just past the last
source character converted.

u The dst parameter may be a null pointer, in which case the converted charac-
ters aren’t stored and the pointer to which src points isn*t modified.

m When either function encounters an invalid character in the source array, it
stores EILSEQ in errno (in addition to returning —1, as the older functions
do).
